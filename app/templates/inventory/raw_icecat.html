{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>Visor de Datos Crudos Icecat (Raw Viewer)</h2>
    <p class="text-muted">Herramienta para inspeccionar la respuesta JSON completa de la API sin procesamiento.</p>

    <div class="card mb-4">
        <div class="card-body">
            <form method="POST" action="{{ url_for('inventory.raw_icecat') }}" class="row g-3">
                <div class="col-md-4">
                    <label for="gtin" class="form-label">GTIN / EAN / UPC</label>
                    <input type="text" class="form-control" id="gtin" name="gtin" placeholder="Ej: 0884116368560"
                        value="{{ gtin if gtin else '' }}" required>
                </div>
                <div class="col-md-2 align-self-end">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-search"></i> Consultar
                    </button>
                </div>
            </form>
        </div>
    </div>

    {% if error %}
    <div class="alert alert-danger">
        {{ error }}
    </div>
    {% endif %}

    {% if raw_data %}
    <div class="card">
        <div class="card-header bg-light d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Respuesta JSON Cruda</h5>
            <button class="btn btn-sm btn-outline-secondary" onclick="copyToClipboard()">
                <i class="fas fa-copy"></i> Copiar
            </button>
        </div>
        <div class="card-body p-0">
            <pre class="m-0 p-3 bg-dark text-light" id="json-output"
                style="max_height: 600px; overflow-y: auto; font-size: 0.85rem;">{{ raw_data | tojson(indent=2) }}</pre>
        </div>
    </div>

    <script>
        function copyToClipboard() {
            const content = document.getElementById('json-output').innerText;
            navigator.clipboard.writeText(content).then(() => {
                alert('JSON copiado al portapapeles');
            });
        }
    </script>
    {% endif %}
</div>
{% endblock %}